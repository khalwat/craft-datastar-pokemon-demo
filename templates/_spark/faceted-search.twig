{# @var store \attributes\stores\FacetedSearch #}

{# Set up the query to get the Pokemon! #}
{% set results = [] %}
{% set query = craft.entries()
    .section(['pokemon'])
    .orderBy('score') %}
{# Handle the generation facet #}
{% if store.generation != 0 %}
    {% do query.generation(store.generation) %}
{% endif %}
{# Handle the generation facet #}
{% if store.type != 'all' %}
    {% do query.type1(store.type) %}
{% endif %}
{# Handle the search string #}
{% if store.search is not empty %}
    {% do query.search(store.search) %}
{% endif %}
{# Execute the query to fetch the results #}
{% set results = query.all() %}

{# The search results fragment #}
{% fragment %}
    {{ include("_includes/search-results.twig", {results}, with_context = false) }}
{% endfragment %}

{# The result count fragment #}
{% fragment %}
    {{ include("_includes/results-count.twig", {results}, with_context = false) }}
{% endfragment %}

{# Increment the number of searches we've done #}
{% do store.searchCount(store.searchCount + 1) %}
